{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/iMAGRAY/MCP-TOOLS/contracts/call-result.schema.json",
  "title": "CallResult",
  "description": "Structured response emitted by inspector_call when the downstream invocation completes. The surrounding MCP envelope exposes CallToolResult._meta.trace following call-trace.schema.json for observability.",
  "type": "object",
  "additionalProperties": false,
  "required": ["content"],
  "properties": {
    "content": {
      "type": "array",
      "description": "Ordered list of RMCP content blocks returned by the downstream tool.",
      "items": {
        "type": "object",
        "additionalProperties": true
      }
    },
    "structured_content": {
      "type": ["object", "null"],
      "description": "Optional structured payload normalized by the downstream tool.",
      "additionalProperties": true,
      "allOf": [
        {
          "if": {
            "type": "object",
            "properties": {
              "mode": { "const": "stream" }
            },
            "required": ["mode"]
          },
          "then": {
            "required": ["mode", "events", "final"],
            "properties": {
              "events": {
                "type": "array",
                "items": { "$ref": "#/$defs/StreamEvent" }
              },
              "final": {
                "type": ["object", "null"],
                "description": "Terminal response snapshot as returned by the downstream tool."
              }
            }
          }
        }
      ]
    }
  },
  "$defs": {
    "StreamEvent": {
      "type": "object",
      "additionalProperties": false,
      "required": ["event"],
      "properties": {
        "event": {
          "type": "string",
          "description": "Event kind. Expected values: chunk, final, or error."
        },
        "progress": {
          "type": "number",
          "description": "Current progress position." 
        },
        "total": {
          "type": "number",
          "description": "Total work units if reported by the downstream tool."
        },
        "message": {
          "type": "string",
          "description": "Optional textual note accompanying the progress event."
        },
        "structured": {
          "type": ["object", "null"],
          "description": "Downstream structured payload for the current chunk, if any.",
          "additionalProperties": true
        },
        "content": {
          "description": "Raw RMCP content emitted with the chunk.",
          "type": ["object", "array", "string", "number", "boolean", "null"],
          "additionalProperties": true
        },
        "error": {
          "type": "string",
          "description": "Error message if the chunk represents a failure." 
        }
      }
    }
  }
}
